<html>

<head></head>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@latest/dist/tfjs-vis.umd.min.js"></script>
<script lang="js">
    const penguinsgUrl = 'penguins.csv';
    const penguinsCSVData = tf.data.csv(penguinsgUrl);
    (async () => {
        const penguinsArrayData = await penguinsCSVData.toArray();
        const penguins = penguinsArrayData.map(p => ({
            bill_length: p.culmen_length_mm,
            bill_depth: p.culmen_depth_mm,
            flipper_length: p.flipper_length_mm,
            body_mass: p.body_mass_g,
            sex: p.sex,
            species: p.species
        }));
        const penguinsAdelie = penguins.filter(p => (p.species == 'Adelie'));
        const penguinsChinstrap = penguins.filter(p => (p.species == 'Chinstrap'));
        const penguinsGentoo = penguins.filter(p => (p.species == 'Gentoo'));
        console.log(penguinsAdelie.length, penguinsChinstrap.length, penguinsGentoo.length);
        const adelie = penguinsAdelie.map(p => ({
            x: p.bill_length,
            y: p.bill_depth,
        }));
        const chinstrap = penguinsChinstrap.map(p => ({
            x: p.bill_length,
            y: p.bill_depth,
        }));
        const gentoo = penguinsGentoo.map(p => ({
            x: p.bill_length,
            y: p.bill_depth,
        }));
        // console.log(adelie.slice(0,10));
        tfvis.render.scatterplot(
            { name: 'Bill length vs depth', tab: 'Bill' },
            { values: [adelie, chinstrap, gentoo], series: ['Adelie', 'Chinstrap', 'Gentoo'] },
            {
                xAxisDomain: [30, 60],
                yAxisDomain: [10, 30],
                xLabel: 'Bill Length',
                yLabel: 'Bill Depth'
            }
        );

        const adelie1 = penguinsAdelie.map(p => ({
            x: p.bill_length,
            y: p.flipper_length,
        }));
        const chinstrap1 = penguinsChinstrap.map(p => ({
            x: p.bill_length,
            y: p.flipper_length,
        }));
        const gentoo1 = penguinsGentoo.map(p => ({
            x: p.bill_length,
            y: p.flipper_length,
        }));

        tfvis.render.scatterplot(
            { name: 'Bill length vs Flipper length', tab: 'Fill' },
            { values: [adelie1, chinstrap1, gentoo1], series: ['Adelie', 'Chinstrap', 'Gentoo'] },
            {
                xAxisDomain: [30, 60],
                yAxisDomain: [150, 250],
                xLabel: 'Bill Length',
                yLabel: 'Flipper Length'
            }
        );

        const inputs = penguins.map(p => ([
            p.bill_length,
            p.bill_depth,
            p.flipper_length,
            p.body_mass,
            p.sex == 'MALE' ? 1 : 0
        ]));
        console.log(inputs[1]);
        const labels = penguins.map(p => ([
            p.species == 'Adelie' ? 1 : 0,
            p.species == 'Chinstrap' ? 1 : 0,
            p.species == 'Gentoo' ? 1 : 0
        ]));
        // console.log(labels[0]);
        const inputTensor = tf.tensor2d(inputs, [inputs.length, 5]);
        const labelTensor = tf.tensor2d(labels, [labels.length, 3]);
        const inputMax = inputTensor.max(0);
        const inputMin = inputTensor.min(0);
        const normalizedInputs = inputTensor.sub(inputMin).div(inputMax.sub(inputMin));
        const model = tf.sequential();
        model.add(tf.layers.dense({ inputShape: [5], units: 5 }));
        // model.add(tf.layers.dense({ activation: "relu", units: 8 }));
        model.add(tf.layers.dense({ activation: "softmax", units: 3 }));
        model.compile({
            loss: "categoricalCrossentropy",
            optimizer: tf.train.adam(0.06),
            metrics: ['acc']
        });
        // tfvis.show.modelSummary({ name: 'Model Summary', tab: 'Model' }, model);
        await model.fit(normalizedInputs, labelTensor, {
            batchSize: 32,
            epochs: 10,
            shuffle: true,
            callbacks: tfvis.show.fitCallbacks(
                { name: 'Training Performance', tab: 'Model' },
                ['loss', 'acc'],
                { height: 200, callbacks: ['onEpochEnd'] }
            )
        });
        const testInputTensor = tf.tensor2d([39.1, 18.7, 181.0, 3750.0, 1], [1, 5]);
        const normalizedTestInput = testInputTensor.sub(inputMin).div(inputMax.sub(inputMin));
        const output = model.predict(normalizedTestInput);
        const pIndex = tf.argMax(output, axis=1).dataSync();
        const classNames = ["Adelie", "Chinstrap", "Gentoo"];
        alert(classNames[pIndex])
    })();
</script>

</html>